{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/user/Desktop/2\\uCC28\\uD504\\uB85C\\uC81D\\uD2B8/DrTart-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _objectSpread from\"C:/Users/user/Desktop/2\\uCC28\\uD504\\uB85C\\uC81D\\uD2B8/DrTart-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/user/Desktop/2\\uCC28\\uD504\\uB85C\\uC81D\\uD2B8/DrTart-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/user/Desktop/2\\uCC28\\uD504\\uB85C\\uC81D\\uD2B8/DrTart-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/user/Desktop/2\\uCC28\\uD504\\uB85C\\uC81D\\uD2B8/DrTart-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useState}from'react';import{Link,useLocation,useParams,useNavigate}from'react-router-dom';import Button from'../../components/Button/Button';import Goods from'./Goods/Goods';import{API_ADDRESS}from'../../apiConfig';import'./Order.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Order=function Order(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),cartList=_useState2[0],setCartList=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOrderLoading=_useState4[0],setIsOrderLoading=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),totalPrice=_useState6[0],setTotalPrice=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isTermsChecked=_useState8[0],setIsTermsChecked=_useState8[1];var _useParams=useParams(),pageType=_useParams.pageType;var location=useLocation();var navigate=useNavigate();var token=localStorage.getItem('TOKEN')||'';var fetchCartData=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var data,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(API_ADDRESS.order_cart,{headers:{Authorization:token}});case 2:data=_context.sent;_context.next=5;return data.json();case 5:res=_context.sent;if(res.cart_info){setCartList(function(){return res.cart_info;});setTotalPrice(function(){return 0;});res.cart_info.forEach(function(_ref2){var price=_ref2.price,quantity=_ref2.quantity;setTotalPrice(function(prev){return prev+price*quantity;});});}else{setCartList(function(){return[];});}case 7:case\"end\":return _context.stop();}}},_callee);})),[token]);useEffect(function(){if(pageType==='cart'){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsOrderLoading(true);_context2.next=3;return fetchCartData();case 3:setIsOrderLoading(false);case 4:case\"end\":return _context2.stop();}}},_callee2);}))();}else{setCartList(function(){return location.state.cartList;});setTotalPrice(function(){return 0;});location.state.cartList.forEach(function(_ref4){var price=_ref4.price,quantity=_ref4.quantity;setTotalPrice(function(prev){return prev+price*quantity;});});}},[fetchCartData,pageType,location]);var adjustCart=function adjustCart(id,quantity){var adjustedList=[];var differ=0;var productId=0;cartList.forEach(function(product){if(product.cart_id===id){differ=quantity-product.quantity;productId=product.product_id;adjustedList.push(_objectSpread(_objectSpread({},product),{},{quantity:quantity}));}else{adjustedList.push(_objectSpread({},product));}});setCartList(adjustedList);fetch(API_ADDRESS.order_cart,{method:'POST',headers:{Authorization:token},body:JSON.stringify({product_id:productId,quantity:differ})});};var adjustTotalPrice=function adjustTotalPrice(type,price){setTotalPrice(function(prev){return type==='minus'?prev-price:prev+price;});};var deleteGoods=function deleteGoods(id){var _cartList$filter=cartList.filter(function(product){return product.cart_id===id;}),_cartList$filter2=_slicedToArray(_cartList$filter,1),targetToDelete=_cartList$filter2[0];adjustTotalPrice('minus',targetToDelete.price*targetToDelete.quantity);setCartList(cartList.filter(function(product){return product.cart_id!==id;}));fetch(API_ADDRESS.order_cart,{method:'DELETE',headers:{Authorization:token},body:JSON.stringify({cart:id})});};var deleteAllGoods=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var targetIndex,_iterator,_step,index;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:targetIndex=cartList.map(function(product){return product.cart_id;});_iterator=_createForOfIteratorHelper(targetIndex);try{for(_iterator.s();!(_step=_iterator.n()).done;){index=_step.value;deleteGoods(index);}}catch(err){_iterator.e(err);}finally{_iterator.f();}setCartList([]);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function deleteAllGoods(){return _ref5.apply(this,arguments);};}();var cartlistCheck=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(cartList.length){navigate('/order/check',{state:{cartList:cartList}});}else{window.alert('결제할 상품이 없습니다.');}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function cartlistCheck(){return _ref6.apply(this,arguments);};}();var onOrder=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var orderTable,data,res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!isTermsChecked){_context5.next=11;break;}orderTable=cartList.map(function(product){return{product_id:product.product_id,quantity:product.quantity};});_context5.next=4;return fetch(API_ADDRESS.order_checkout,{method:'POST',headers:{Authorization:token},body:JSON.stringify(orderTable)});case 4:data=_context5.sent;_context5.next=7;return data.json();case 7:res=_context5.sent;navigate(\"/order/confirm?order=\".concat(res.message));_context5.next=12;break;case 11:window.alert('약관에 동의해주셔야 결제가 가능합니다.');case 12:case\"end\":return _context5.stop();}}},_callee5);}));return function onOrder(){return _ref7.apply(this,arguments);};}();var onOrderFailed=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var orderTable;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!isTermsChecked){_context6.next=7;break;}orderTable=cartList.map(function(product){return{product_id:product.product_id,quantity:product.quantity};});_context6.next=4;return fetch(API_ADDRESS.order_fail,{method:'POST',headers:{Authorization:token},body:JSON.stringify(orderTable)});case 4:window.alert('비정상적인 오류로 결제에 실패했습니다.');_context6.next=8;break;case 7:window.alert('약관에 동의해주셔야 결제가 가능합니다.');case 8:case\"end\":return _context6.stop();}}},_callee6);}));return function onOrderFailed(){return _ref8.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"order\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pageTitleArea\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"progressNav\",children:/*#__PURE__*/_jsxs(\"ul\",{className:\"progress\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"stepOne\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"01 \\uC7A5\\uBC14\\uAD6C\\uB2C8\"}),pageType==='cart'&&/*#__PURE__*/_jsx(\"span\",{className:\"line\"})]}),/*#__PURE__*/_jsxs(\"li\",{className:\"stepTwo\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"02 \\uACB0\\uC81C\\uC9C4\\uD589\"}),pageType==='check'&&/*#__PURE__*/_jsx(\"span\",{className:\"line\"})]}),/*#__PURE__*/_jsx(\"li\",{className:\"stepThree\",children:/*#__PURE__*/_jsx(\"p\",{children:\"03 \\uC8FC\\uBB38\\uC644\\uB8CC\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"pageTitle\",children:/*#__PURE__*/_jsxs(\"h1\",{className:\"orderTitle\",children:[pageType==='cart'&&'장바구니',pageType==='check'&&'결제진행']})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pageContent\",children:[/*#__PURE__*/_jsxs(\"section\",{className:\"productSection\",children:[cartList.length?!isOrderLoading&&/*#__PURE__*/_jsxs(\"table\",{className:\"goodsTable\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"goodsTableHead\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"tableHeadElement tableHeadImage\"}),/*#__PURE__*/_jsx(\"th\",{className:\"tableHeadElement tableHeadGoods\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uC0C1\\uD488\"})}),/*#__PURE__*/_jsx(\"th\",{className:\"tableHeadElement tableHeadQuantity\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uC218\\uB7C9\"})}),/*#__PURE__*/_jsx(\"th\",{className:\"tableHeadElement tableHeadPrice\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uAE08\\uC561\"})}),/*#__PURE__*/_jsx(\"th\",{className:\"tableHeadElement tableHeadButton\"})]})}),cartList.map(function(product){return/*#__PURE__*/_jsx(Goods,{product:product,pageType:pageType,deleteGoods:deleteGoods,adjustTotalPrice:adjustTotalPrice,adjustCart:adjustCart},product.cart_id);})]}):/*#__PURE__*/_jsx(\"div\",{className:\"nullContentTable\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uC7A5\\uBC14\\uAD6C\\uB2C8\\uC5D0 \\uB2F4\\uAE34 \\uC0C1\\uD488\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})}),pageType==='cart'&&/*#__PURE__*/_jsx(\"div\",{className:\"cartButtonContainer\",children:/*#__PURE__*/_jsx(\"div\",{className:\"cartButtonWrapper\",children:cartList.length?/*#__PURE__*/_jsx(Button,{btnOnClick:deleteAllGoods,children:\"\\uC7A5\\uBC14\\uAD6C\\uB2C8 \\uBE44\\uC6B0\\uAE30\"}):/*#__PURE__*/_jsx(Link,{to:\"/product-list\",children:/*#__PURE__*/_jsx(Button,{children:\"\\uC1FC\\uD551 \\uACC4\\uC18D\\uD558\\uAE30\"})})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"orderTotal\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"orderInfoContainer\",children:/*#__PURE__*/_jsxs(\"dl\",{className:\"pdtPrice\",children:[/*#__PURE__*/_jsx(\"dt\",{children:\"\\uCD1D \\uC0C1\\uD488 \\uAE08\\uC561\"}),/*#__PURE__*/_jsxs(\"dd\",{children:[totalPrice,\"\\uC6D0\"]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"orderInfoContainer\",children:/*#__PURE__*/_jsxs(\"dl\",{className:\"payPrice\",children:[/*#__PURE__*/_jsx(\"dt\",{children:\"\\uCD5C\\uC885 \\uACB0\\uC81C \\uAE08\\uC561\"}),/*#__PURE__*/_jsxs(\"dd\",{className:\"payPriceNum\",children:[totalPrice,\"\\uC6D0\"]})]})}),pageType!=='cart'&&/*#__PURE__*/_jsxs(\"div\",{className:\"orderInfoContainer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selectBox\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"selectedValue\",children:\"\\uC2E0\\uC6A9\\uCE74\\uB4DC\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"valueList\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\uC2E0\\uC6A9\\uCE74\\uB4DC\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\uCE74\\uCE74\\uC624\\uD398\\uC774\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\uB124\\uC774\\uBC84\\uD398\\uC774\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\uD734\\uB300\\uD3F0\\uACB0\\uC81C\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\uD3EC\\uC778\\uD2B8\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mustCheck\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"checkBox\",type:\"checkbox\",value:isTermsChecked,onChange:function onChange(){return setIsTermsChecked(function(prev){return!prev;});}}),/*#__PURE__*/_jsxs(\"label\",{className:\"label\",htmlFor:\"agree\",children:[\"\\uAD6C\\uB9E4\\uD558\\uC2E4 \\uC0C1\\uD488\\uC758 \\uD310\\uB9E4\\uC870\\uAC74\\uC744 \\uBA85\\uD655\\uD788 \\uD655\\uC778\\uD558\\uC600\\uC73C\\uBA70, \\uC774\\uC5D0 \\uB3D9\\uC758\\uD569\\uB2C8\\uB2E4.\",/*#__PURE__*/_jsx(\"br\",{}),\"(\\uC804\\uC790\\uC0C1\\uAC70\\uB798\\uBC95 \\uC81C8\\uC870 2\\uD56D)\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"orderCheckButtonWrapper\",children:pageType==='cart'?/*#__PURE__*/_jsx(Button,{btnOnClick:cartlistCheck,children:\"\\uC7A5\\uBC14\\uAD6C\\uB2C8 \\uC0C1\\uD488 \\uC8FC\\uBB38\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{btnOnClick:onOrder,children:\"\\uACB0\\uC81C\\uD558\\uAE30\"}),/*#__PURE__*/_jsx(\"button\",{className:\"hiden\",onClick:onOrderFailed,children:\"\\uACB0\\uC81C\\uC2E4\\uD328\"})]})})]})]})]});};export default Order;","map":{"version":3,"sources":["C:/Users/user/Desktop/2차프로젝트/DrTart-frontend/src/pages/Order/Order.js"],"names":["React","useCallback","useEffect","useState","Link","useLocation","useParams","useNavigate","Button","Goods","API_ADDRESS","Order","cartList","setCartList","isOrderLoading","setIsOrderLoading","totalPrice","setTotalPrice","isTermsChecked","setIsTermsChecked","pageType","location","navigate","token","localStorage","getItem","fetchCartData","fetch","order_cart","headers","Authorization","data","json","res","cart_info","forEach","price","quantity","prev","state","adjustCart","id","adjustedList","differ","productId","product","cart_id","product_id","push","method","body","JSON","stringify","adjustTotalPrice","type","deleteGoods","filter","targetToDelete","cart","deleteAllGoods","targetIndex","map","index","cartlistCheck","length","window","alert","onOrder","orderTable","order_checkout","message","onOrderFailed","order_fail"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { Link, useLocation, useParams, useNavigate } from 'react-router-dom';\nimport Button from '../../components/Button/Button';\nimport Goods from './Goods/Goods';\nimport { API_ADDRESS } from '../../apiConfig';\nimport './Order.scss';\n\nconst Order = () => {\n  const [cartList, setCartList] = useState([]);\n  const [isOrderLoading, setIsOrderLoading] = useState(false);\n  const [totalPrice, setTotalPrice] = useState(0);\n  const [isTermsChecked, setIsTermsChecked] = useState(false);\n  const { pageType } = useParams();\n  const location = useLocation();\n  const navigate = useNavigate();\n  let token = localStorage.getItem('TOKEN') || '';\n\n  const fetchCartData = useCallback(async () => {\n    const data = await fetch(API_ADDRESS.order_cart, {\n      headers: { Authorization: token },\n    });\n    const res = await data.json();\n    if (res.cart_info) {\n      setCartList(() => res.cart_info);\n      setTotalPrice(() => 0);\n      res.cart_info.forEach(({ price, quantity }) => {\n        setTotalPrice(prev => prev + price * quantity);\n      });\n    } else {\n      setCartList(() => []);\n    }\n  }, [token]);\n\n  useEffect(() => {\n    if (pageType === 'cart') {\n      (async () => {\n        setIsOrderLoading(true);\n        await fetchCartData();\n        setIsOrderLoading(false);\n      })();\n    } else {\n      setCartList(() => location.state.cartList);\n      setTotalPrice(() => 0);\n      location.state.cartList.forEach(({ price, quantity }) => {\n        setTotalPrice(prev => prev + price * quantity);\n      });\n    }\n  }, [fetchCartData, pageType, location]);\n\n  const adjustCart = (id, quantity) => {\n    let adjustedList = [];\n    let differ = 0;\n    let productId = 0;\n    cartList.forEach(product => {\n      if (product.cart_id === id) {\n        differ = quantity - product.quantity;\n        productId = product.product_id;\n        adjustedList.push({ ...product, quantity: quantity });\n      } else {\n        adjustedList.push({ ...product });\n      }\n    });\n    setCartList(adjustedList);\n\n    fetch(API_ADDRESS.order_cart, {\n      method: 'POST',\n      headers: {\n        Authorization: token,\n      },\n      body: JSON.stringify({\n        product_id: productId,\n        quantity: differ,\n      }),\n    });\n  };\n\n  const adjustTotalPrice = (type, price) => {\n    setTotalPrice(prev => (type === 'minus' ? prev - price : prev + price));\n  };\n\n  const deleteGoods = id => {\n    const [targetToDelete] = cartList.filter(product => product.cart_id === id);\n    adjustTotalPrice('minus', targetToDelete.price * targetToDelete.quantity);\n    setCartList(cartList.filter(product => product.cart_id !== id));\n\n    fetch(API_ADDRESS.order_cart, {\n      method: 'DELETE',\n      headers: {\n        Authorization: token,\n      },\n      body: JSON.stringify({\n        cart: id,\n      }),\n    });\n  };\n\n  const deleteAllGoods = async () => {\n    const targetIndex = cartList.map(product => product.cart_id);\n    for (let index of targetIndex) {\n      deleteGoods(index);\n    }\n    setCartList([]);\n  };\n\n  const cartlistCheck = async () => {\n    if (cartList.length) {\n      navigate('/order/check', { state: { cartList } });\n    } else {\n      window.alert('결제할 상품이 없습니다.');\n    }\n  };\n\n  const onOrder = async () => {\n    if (isTermsChecked) {\n      const orderTable = cartList.map(product => ({\n        product_id: product.product_id,\n        quantity: product.quantity,\n      }));\n\n      const data = await fetch(API_ADDRESS.order_checkout, {\n        method: 'POST',\n        headers: {\n          Authorization: token,\n        },\n        body: JSON.stringify(orderTable),\n      });\n\n      const res = await data.json();\n\n      navigate(`/order/confirm?order=${res.message}`);\n    } else {\n      window.alert('약관에 동의해주셔야 결제가 가능합니다.');\n    }\n  };\n\n  const onOrderFailed = async () => {\n    if (isTermsChecked) {\n      const orderTable = cartList.map(product => ({\n        product_id: product.product_id,\n        quantity: product.quantity,\n      }));\n\n      await fetch(API_ADDRESS.order_fail, {\n        method: 'POST',\n        headers: {\n          Authorization: token,\n        },\n        body: JSON.stringify(orderTable),\n      });\n      window.alert('비정상적인 오류로 결제에 실패했습니다.');\n    } else {\n      window.alert('약관에 동의해주셔야 결제가 가능합니다.');\n    }\n  };\n\n  return (\n    <div className=\"order\">\n      <div className=\"pageTitleArea\">\n        <div className=\"progressNav\">\n          <ul className=\"progress\">\n            <li className=\"stepOne\">\n              <p>01 장바구니</p>\n              {pageType === 'cart' && <span className=\"line\" />}\n            </li>\n            <li className=\"stepTwo\">\n              <p>02 결제진행</p>\n              {pageType === 'check' && <span className=\"line\" />}\n            </li>\n            <li className=\"stepThree\">\n              <p>03 주문완료</p>\n            </li>\n          </ul>\n        </div>\n        <div className=\"pageTitle\">\n          <h1 className=\"orderTitle\">\n            {pageType === 'cart' && '장바구니'}\n            {pageType === 'check' && '결제진행'}\n          </h1>\n        </div>\n      </div>\n      <div className=\"pageContent\">\n        <section className=\"productSection\">\n          {cartList.length ? (\n            !isOrderLoading && (\n              <table className=\"goodsTable\">\n                <thead className=\"goodsTableHead\">\n                  <tr>\n                    <th className=\"tableHeadElement tableHeadImage\" />\n                    <th className=\"tableHeadElement tableHeadGoods\">\n                      <p>상품</p>\n                    </th>\n                    <th className=\"tableHeadElement tableHeadQuantity\">\n                      <p>수량</p>\n                    </th>\n                    <th className=\"tableHeadElement tableHeadPrice\">\n                      <p>금액</p>\n                    </th>\n                    <th className=\"tableHeadElement tableHeadButton\" />\n                  </tr>\n                </thead>\n                {cartList.map(product => (\n                  <Goods\n                    key={product.cart_id}\n                    product={product}\n                    pageType={pageType}\n                    deleteGoods={deleteGoods}\n                    adjustTotalPrice={adjustTotalPrice}\n                    adjustCart={adjustCart}\n                  />\n                ))}\n              </table>\n            )\n          ) : (\n            <div className=\"nullContentTable\">\n              <p>장바구니에 담긴 상품이 없습니다.</p>\n            </div>\n          )}\n          {pageType === 'cart' && (\n            <div className=\"cartButtonContainer\">\n              <div className=\"cartButtonWrapper\">\n                {cartList.length ? (\n                  <Button btnOnClick={deleteAllGoods}>장바구니 비우기</Button>\n                ) : (\n                  <Link to=\"/product-list\">\n                    <Button>쇼핑 계속하기</Button>\n                  </Link>\n                )}\n              </div>\n            </div>\n          )}\n        </section>\n        <div className=\"orderTotal\">\n          <div className=\"orderInfoContainer\">\n            <dl className=\"pdtPrice\">\n              <dt>총 상품 금액</dt>\n              <dd>{totalPrice}원</dd>\n            </dl>\n          </div>\n          <div className=\"orderInfoContainer\">\n            <dl className=\"payPrice\">\n              <dt>최종 결제 금액</dt>\n              <dd className=\"payPriceNum\">{totalPrice}원</dd>\n            </dl>\n          </div>\n          {pageType !== 'cart' && (\n            <div className=\"orderInfoContainer\">\n              <div className=\"selectBox\">\n                <button className=\"selectedValue\">신용카드</button>\n                <ul className=\"valueList\">\n                  <li>신용카드</li>\n                  <li>카카오페이</li>\n                  <li>네이버페이</li>\n                  <li>휴대폰결제</li>\n                  <li>포인트</li>\n                </ul>\n              </div>\n              <div className=\"mustCheck\">\n                <input\n                  className=\"checkBox\"\n                  type=\"checkbox\"\n                  value={isTermsChecked}\n                  onChange={() => setIsTermsChecked(prev => !prev)}\n                />\n                <label className=\"label\" htmlFor=\"agree\">\n                  구매하실 상품의 판매조건을 명확히 확인하였으며, 이에\n                  동의합니다.\n                  <br />\n                  (전자상거래법 제8조 2항)\n                </label>\n              </div>\n            </div>\n          )}\n\n          <div className=\"orderCheckButtonWrapper\">\n            {pageType === 'cart' ? (\n              <Button btnOnClick={cartlistCheck}>장바구니 상품 주문</Button>\n            ) : (\n              <>\n                <Button btnOnClick={onOrder}>결제하기</Button>\n                <button className=\"hiden\" onClick={onOrderFailed}>\n                  결제실패\n                </button>\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\nexport default Order;\n"]},"metadata":{},"sourceType":"module"}